<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Caching • archivist</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">archivist</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Caching</h1>
            
          </div>

    
    
<div class="contents">
<p>The archivist package allows to store, restore and look for R objects in repositories stored on hard disk. There are different strategies that can be used to find an object, through it’s name, date of creation of meta data. The package is mainly designed as a repository of artifacts, but it can be used in different use-cases.</p>
<p>Let’s see how it can be used as caching engine.</p>
<p>Let’s consider a function with few arguments, which evaluation may takes a significant amount of time. If there is a chance that the function will be executed with same parameteres more than just one, it would be desireble to cache results to avoid unncessary evaluations.</p>
<p>Such cache can be easily constructed with the <code>archivist</code> package.</p>
<div id="heavyweight-function" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#heavyweight-function" class="anchor"> </a></body></html>Heavyweight function</h1>
<p>Let’s see an example. The <code>Heavyweight</code> function <code>getMaxDistribution</code> summarizes the distribution of maximum from N draw of random variables from distribuition D with the use of R replications.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">getMaxDistribution &lt;-<span class="st"> </span>function(
    <span class="dt">D =</span> rnorm, 
    <span class="dt">N =</span> <span class="dv">10</span>,
    <span class="dt">R =</span> <span class="dv">1000000</span>) {
    res &lt;-<span class="st"> </span><span class="kw">replicate</span>(R, <span class="kw">max</span>(<span class="kw">D</span>(N)))
  <span class="kw">summary</span>(res)
}

<span class="kw">system.time</span>(<span class="kw">getMaxDistribution</span>(rnorm, <span class="dv">10</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">   user  system elapsed 
  <span class="fl">5.477</span>   <span class="fl">0.035</span>   <span class="fl">5.511</span> </code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(<span class="kw">getMaxDistribution</span>(rexp, <span class="dv">20</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">   user  system elapsed 
  <span class="fl">5.156</span>   <span class="fl">0.008</span>   <span class="fl">5.164</span> </code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(<span class="kw">getMaxDistribution</span>(rnorm, <span class="dv">10</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">   user  system elapsed 
  <span class="fl">4.845</span>   <span class="fl">0.001</span>   <span class="fl">4.844</span> </code></pre></div>
<p>Now, let’s load the archivist package and prepare a repository for cached objects.</p>
</div>
<div id="cache-preparation" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#cache-preparation" class="anchor"> </a></body></html>Cache preparation</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(archivist)
cacheRepo &lt;-<span class="st"> </span><span class="kw">tempfile</span>()
<span class="kw"><a href="../reference/createLocalRepo.html">createLocalRepo</a></span>(cacheRepo)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Directory /tmp/Rtmp45GZsm/file65d3676f9387 did not exist. Forced to create a new directory.</code></pre></div>
</div>
<div id="how-to-work-with-cache" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#how-to-work-with-cache" class="anchor"> </a></body></html>How to work with cache</h1>
<p>The <code>cacheRepo</code> is a folder with already evaluated function calls. How to use it?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(<span class="kw"><a href="../reference/cache.html">cache</a></span>(cacheRepo, getMaxDistribution, rnorm, <span class="dv">10</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">   user  system elapsed 
  <span class="fl">4.738</span>   <span class="fl">0.004</span>   <span class="fl">4.740</span> </code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(<span class="kw"><a href="../reference/cache.html">cache</a></span>(cacheRepo, getMaxDistribution, rexp, <span class="dv">10</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">   user  system elapsed 
  <span class="fl">4.950</span>   <span class="fl">0.008</span>   <span class="fl">4.955</span> </code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system.time</span>(<span class="kw"><a href="../reference/cache.html">cache</a></span>(cacheRepo, getMaxDistribution, rnorm, <span class="dv">10</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">   user  system elapsed 
  <span class="fl">0.003</span>   <span class="fl">0.000</span>   <span class="fl">0.003</span> </code></pre></div>
<p>The second evaluation of <code>getMaxDistribution</code> is much, much faster. Results are just read from disk.</p>
</div>
<div id="how-the-cache-function-works" class="section level1">
<h1 class="hasAnchor">
<html><body><a href="#how-the-cache-function-works" class="anchor"> </a></body></html>How the <code>cache</code> function works?</h1>
<p>It create a md5 signature of the function FUN and it’s arguments and use this signature as a key. If such key is present in the cache repository, then the object is just restored. If it’s not present then the call is evaluated and result is stored. Note that, if <code>cacheRepo</code> is a shared folder, then you get a shared cache repository!</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#heavyweight-function">Heavyweight function</a></li>
      <li><a href="#cache-preparation">Cache preparation</a></li>
      <li><a href="#how-to-work-with-cache">How to work with cache</a></li>
      <li><a href="#how-the-cache-function-works">How the <code>cache</code> function works?</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Przemyslaw Biecek, Marcin Kosinski.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
