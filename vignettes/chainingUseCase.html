<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Archiving artifacts with their chaining code</title>
<link rel="stylesheet" media="all" href="http://jashkenas.github.io/docco/resources/linear/public/stylesheets/normalize.css" />
<link rel="stylesheet" media="all" href="http://jashkenas.github.io/docco/resources/linear/docco.css" />
<link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/default.min.css">
<style type="text/css">
img{display:block;margin:auto;}
.container{width:920px;}
.page{width:800px;}
.page pre{width:768px;}
pre, code{font-size:90%;}
</style>
<script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script>
<script src="http://yandex.st/highlightjs/8.0/languages/r.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


</head>

<body>
  <div class="container">
    <div class="page">
<!--
%\VignetteEngine{knitr::docco_linear}
%\VignetteIndexEntry{The archivist package compendium}
-->

<h1>Archiving artifacts with their chaining code</h1>

<p>The <strong>archivist</strong> package is very efficient and advantageous when the archived artifacts were created with a chaining code, offered by <a href="https://github.com/hadley/dplyr">dplyr</a> package. It is higly useful because the origin of the artifact is archived, what means that the artifact can be easly reproduced and it&#39;s origin code is stored for future use.</p>

<p>Below are examples of creating artifacts with a chaining code, that requires using a <code>%&gt;%</code> and  a <code>%.%</code> operators, offered by <strong>dplyr</strong> package.</p>

<p>Let us prepare a <a href="https://github.com/pbiecek/archivist/wiki/archivist-package-Repository"><strong>Repository</strong></a> where archived artifacts will be stored.</p>

<pre><code class="r">library(devtools)
install_github(&quot;archivist&quot;, &quot;pbiecek&quot;)
library(archivist)
exampleRepoDir &lt;- getwd()
createEmptyRepo( exampleRepoDir )
</code></pre>

<p>Then one might create artifacts like those below. The code lines are ordered in chaining code, which will be used by <code>saveToRepo</code> function to store an artifact and archive it&#39;s origin code as a <code>name</code> of this artifact.</p>

<pre><code class="r"># example 1
library(dplyr)

data(&quot;hflights&quot;, package = &quot;hflights&quot;)
hflights %&gt;%
   group_by(Year, Month, DayofMonth) %&gt;%
   select(Year:DayofMonth, ArrDelay, DepDelay) %&gt;%
   summarise(
      arr = mean(ArrDelay, na.rm = TRUE),
      dep = mean(DepDelay, na.rm = TRUE)
   ) %&gt;%
   filter(arr &gt; 30 | dep &gt; 30) %&gt;%
   saveToRepo( exampleRepoDir )  
</code></pre>

<pre><code>[1] &quot;9013563d1069359f9b7d7a49c49b0a1f&quot;
</code></pre>

<p>One may see a vast difference in code evalution when using chaining code.
Here is an example of traditional <code>R</code> call and one that uses <code>chaining code</code> philosophy.</p>

<pre><code class="r"># example 2
library(Lahman)

# Traditional R code
players &lt;- group_by(Batting, playerID)
games &lt;- summarise(players, total = sum(G))
head(arrange(games, desc(total)), 5)
</code></pre>

<pre><code>Source: local data frame [5 x 2]

   playerID total
1  rosepe01  3562
2 yastrca01  3308
3 aaronha01  3298
4 henderi01  3081
5  cobbty01  3035
</code></pre>

<pre><code class="r"># Corresponding chaining code
Batting %.%
   group_by(playerID) %.%
   summarise(total = sum(G)) %.%
   arrange(desc(total)) %.%
   head(5) %&gt;%
   saveToRepo( exampleRepoDir )
</code></pre>

<pre><code>[1] &quot;6defe8a423a1363463a3ed98435c02e8&quot;
</code></pre>

<p>Many of various operations can be performed on a single <code>data.frame</code> before one consideres to archive this artifacts. The <strong>archivist</strong> guarantees that all of them will be <code>archived</code>, which means a code alone will no longer be needed to be stored in a separate file. The <code>CrimeStatebyState</code> data set can be downloaded from <a href="https://github.com/MarcinKosinski/Museum">here</a>.</p>

<pre><code class="r"># example 3
crime.by.state &lt;- read.csv(&quot;CrimeStatebyState.csv&quot;)
crime.by.state %.%
   filter(State==&quot;New York&quot;, Year==2005) %.%
   arrange(desc(Count)) %.%
   select(Type.of.Crime, Count) %.%
   mutate(Proportion=Count/sum(Count)) %.%
   group_by(Type.of.Crime) %.%
   summarise(num.types = n(), counts = sum(Count)) %&gt;%
   saveToRepo( exampleRepoDir )
</code></pre>

<pre><code>[1] &quot;09cbff009bfb9b8535f1bb65f5cdec1b&quot;
</code></pre>

<p>Dozens of artifacts may now be stored in one, full of links <strong>Repository</strong>.</p>

<pre><code class="r"># example 4
library(ggplot2)

diamonds %.% 
   group_by(cut, clarity, color) %.%  
   summarize(
      meancarat = mean(carat, na.rm = TRUE), 
      ndiamonds = length(carat)
   ) %&gt;%
head( 10) %&gt;%
   saveToRepo( exampleRepoDir )
</code></pre>

<pre><code>[1] &quot;6a9d5d46c5c36a0cbe06b4acabcd03e9&quot;
</code></pre>

<p>One might save artifact&#39;s <a href="https://github.com/pbiecek/archivist/wiki/archivist-package-md5hash">md5hash</a> in case to check his origin stored in a <a href="https://github.com/pbiecek/archivist/wiki/archivist-package---Tags">Tag</a>
named <code>name</code>.</p>

<pre><code class="r"># example 5
data(mtcars)
hash &lt;- mtcars %.% 
   group_by(cyl, am) %.%
   select(mpg, cyl, wt, am) %.%
   summarise(avgmpg = mean(mpg), avgwt = mean(wt)) %.%
   filter(avgmpg &gt; 20) %&gt;%
   saveToRepo( exampleRepoDir )
</code></pre>

<p>After archiving all desired artifacts created with their chaining code, the summary of the <strong>Repository</strong> might be performed. Below is a single call of stored artifacts&#39; names and the summary of the whole created <strong>Repository</strong> in this use case.</p>

<pre><code class="r"># summary
showLocalRepo( exampleRepoDir )[, 2]
</code></pre>

<pre><code>[1] &quot;hflights %&gt;% group_by(Year, Month, DayofMonth) %&gt;% select(Year:DayofMonth,     ArrDelay, DepDelay) %&gt;% summarise(arr = mean(ArrDelay, na.rm = TRUE),     dep = mean(DepDelay, na.rm = TRUE)) %&gt;% filter(arr &gt; 30 |     dep &gt; 30)&quot;                              
[2] &quot;Batting %.% group_by(playerID) %.% summarise(total = sum(G)) %.%     arrange(desc(total)) %.% head(5)&quot;                                                                                                                                                         
[3] &quot;crime.by.state %.% filter(State == \&quot;New York\&quot;, Year == 2005) %.%     arrange(desc(Count)) %.% select(Type.of.Crime, Count) %.%     mutate(Proportion = Count/sum(Count)) %.% group_by(Type.of.Crime) %.%     summarise(num.types = n(), counts = sum(Count))&quot;
[4] &quot;diamonds %.% group_by(cut, clarity, color) %.% summarize(meancarat = mean(carat,     na.rm = TRUE), ndiamonds = length(carat)) %&gt;% head(10)&quot;                                                                                                                   
[5] &quot;mtcars %.% group_by(cyl, am) %.% select(mpg, cyl, wt, am) %.%     summarise(avgmpg = mean(mpg), avgwt = mean(wt)) %.% filter(avgmpg &gt;     20)&quot;                                                                                                                 
</code></pre>

<pre><code class="r">summaryLocalRepo( exampleRepoDir )
</code></pre>

<pre><code>Number of archived artifacts in the Repository:  5 
Number of archived datasets in the Repository:  0 
Number of various classes archived in the Repository: 
            Number
grouped_df      3
tbl_df          2
Saves per day in the Repository: 
            Saves
2014-09-03     5
</code></pre>

<p>One can restore the origin of the artifact created in example 5.</p>

<pre><code class="r">returnTag( md5hash = hash, exampleRepoDir )
</code></pre>

<pre><code>[1] &quot;mtcars %.% group_by(cyl, am) %.% select(mpg, cyl, wt, am) %.%     summarise(avgmpg = mean(mpg), avgwt = mean(wt)) %.% filter(avgmpg &gt;     20)&quot;
</code></pre>

      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
